## 数仓

### 1.数仓分层的作用

1. 清晰数据结构
   	每个数据分层都有它的作用域，这样我们在使用表的时候更方便理解和定位。能将数据关系条理化：源系统间存在复杂的数据关系，比如用户信息同时在核心系统、信贷系统、资金系统，取数时如何决策？数仓会对相同主题的数据进行统一建模，把复杂的数据关系梳理成条理清晰的数据模型，就能很好的解决上述问题。
2. 数据血缘关系追踪
           如果一张表出现问题，我们能通过数据血缘关系对问题进行快速准确的定位，并清楚它的危害范围
3. 数据复用、减少重复开发
           因为我们数仓的数据是逐层加工的，下层包含了上层数据加工所需要的全量数据，这样能避免每个数据开发人员都从源系统抽取数据进行加工。同时，数仓的汇总层能避免下游用户逻辑的重复计算，极大的降低了计算和存储成本。
4. 统一数据口径
           通过数据分层，提供统一的数据出口，统一对外输出的数据口径
5. 复杂问题简单化
           能将复杂任务分解成多个步骤完成，每个分层只处理单一的步骤，比较简单和容易理解。当数据出现问题，就不用修复所有的数据，只需要从有问题的步骤开始修复，能很好的对数据准确性进行维护
6. 屏蔽原始数据及业务的影响
           屏蔽源头业务系统的复杂性：业务源系统可能很复杂，在表、字段、字段含义上存在问题，一致性很差。通过DW层来规范和屏蔽这些复杂性，来保证下游用户数据的使用。如果源系统业务发生变更，相关的变更直接由DW层来处理，对下游用户透明，无需改动下游的代码和逻辑。

### 2.数据同步之全量、增量

- 全量同步
  	离线数仓中，全量同步是指每天拉取业务系统中的全量快照数据，落在ODS表相关分区中（以日期作为分区字段）。一般全量同步方式适合<u>数据量不是很大的表</u>（规范层面可以制定1亿条数据量以下可以选择全量同步，操作1亿增量同步）。以天为单位的全量存储，以业务日期作为分区，每个分区存放截止到业务日期为止的全量业务数据。例如：对于借款申请表，假设订单量在3000w级别，即可考虑全量同步的方式。对于ods的表按天存放历史截止到T-1日发生的借款申请数据，ods表每天新增一个分区用于存放

- 增量同步
          离线数仓中，增量同步是指每天拉取业务系统中表的增量日期字段为T-1日的数据，落在ods表t-1分区中（所以理想状态下ods增量表全部分区组成业务系统对应表的所有数据）。一般对于数据量过于庞大，或者业务系统中数据落表后不会更新的表，都可以采用增量同步的方式。增量同步一般可以选择：创建时间/更新时间同步。

  选择创建时间同步的数据一般都是业务系统中数据落表后不会更新的表，如日志表（额度变更日志表）或者记录表（风控流水记录表）。注意：对业务系统会表数据做归档的表，ods层也可配合全改增脚本实现业务系统数据的积累，以供仓内任务重跑和数据回溯工作。

    选择更新时间同步的数据一般都是业务系统中数据落表后会更新且数据量比较大的表，通过更新时间同步到ods第一层表后，配合增改全脚本的方式获取最新全量快照的数据。如授信申请表。

### 3.维度退化、维度下沉

### 4.数据域划分

### 5.数仓项目的难点和最大挑战

**数据质量治理**：数据准确性和失效性时数据质量的基本要求，直接影响数仓的生死存亡，如果做不到数据按时可靠，可能会直接导致数仓砍掉，这是一个数仓的痛点，没办法根绝掉，会伴随整个数仓建设的全生命周期，只能不断的迭代、优化监控规则，把数据质量提高，只能说找到更有的解决方案，解决更多的数据质量问题。
大数据量处理：需要优化查询性能，需要调整分区策略，甚至要借助其他组件来处理
多样化的数据需求:业务需求变化频繁，可能会非常规的需求，突破架构的，架构不支持的这种需求，怎么利用现有的资源去解决这些需求。
技术的选型和更新：数据领域的技术在不断的发展和演进，需要关注最新的数仓技术趋势，选择适合项目需求的技术和工具，更好的建设数仓，能够管理和维护现有的数仓系统，包括升级和迁移现有的数据仓库。
故障排查和调试：在数仓开发上线的过程中，需要具备故障排查和解决问题的能力，并不是所有的问题很直观的展示出来，特别是基于开源工具的，可能还要查看源码。
**跨团队沟通**：在数仓开发过程中需要与其他团队和利益相关方进行合作和沟通，有效的跨团队和做和沟通是保障数仓项目成功的关键。
复杂业务规则和逻辑：在一些复杂的业务场景中，可能需要处理各种复杂的业务规则和逻辑，需要增加业务的沉淀和积累，了解仓内的模型、将业务口径转化成技术口径。
数仓架构设计和优化：综合考虑数仓的需求和性能设计适合的数据架构，进行模型设计和优化、以满足业务需求和性能要求。
数据的生命周期管理：数据具有不同的生命周期，需要进行有效的数据管理策略和存储策略，数仓开发工程师要制定合适的数据保留期限、归档、清理策略，在最大化降低存储成本的情况下不影响业务的正常使用中找到平衡。
大部分不能百分之百解决，只能选择折衷的办法，以求做到更好，做不到最好
**数据质量治理**：时效性治理，之前是在9点出数，领导要求7点之前出数，有一个任务链路非常老、首先改变了存储格式、把textfile改成orc，列式存储压缩比高，数据文件大小降低、ORC轻量索引读数据很快，提前了一小时，然后这个任务快1千多行了，很多逻辑可以并行跑，增加中间层2个脚本，还有很多大表关联小表的，调整join策略，又快了差不多一个小时。



## 数仓建设规范

### 1.数仓开发流程规范SOP

### 2.数仓架构|层级规范治理实践

### 3.数仓模型命名与标准规范

### 4.数仓模型设计方法论与规范

### 5.指标定义与管理规范治理

### 6.模型和代码开发管理规范

### 7.集群任务部署开发管理规范





## 15k面试题

1. 数仓分层架构，模型问题举例，信贷数仓应用层涉及那些应用

2. 数仓和数据集市的认识，对应的边界

   > 数仓是存储数据的仓库，不同于传统的数据库主要支持联机事务处理OLTP，数仓主要是做联机分析处理的OLAP，数仓将多个业务系统的数据集成在一起，对数据进行统一规范、分类，存储历史数据，与事务操作隔离开。数仓是一个集成的、一致性的反应历史变化数据的稳定仓库。与传统数仓相比，大数据平台可以运行在廉价的服务器上，传统数仓通常是搭建在oracle数据库上，成本高、只能支持一些结构化的数据。
   >
   > 集市是数仓的一个子集，集市是以业务需求为驱动进行数据建模，按照一定的主题或者领域进行划分和组织、形成独立的数据集合。集市通常包含特定的业务领域或者业务功能所属的数据，满足用户对特定数据的快速查询和分析需求,数据集市相当于是部门级数仓，面向需求开发，主要是为了支撑部门决策。
   > 而数仓更加全面、综合面向整个企业，数据仓库的建设和维护需要更多的技术和资源投人，包括数据的提取转换和加载、数据模型设计、数据质量的管理等方面，需要统一的数据标准、数据模型和全面化的管理。数据集市相对较小和独立，建设和维护较为简单和敏捷，取数仓现有的模型进行二次开发。

3. 数据清洗操作

   > #### 数据仓库的ETL流程
   >
   > ETL是抽取、转换、加载，是数据仓库中常见的数据处理流程，将数据从源系统提取出来，经过一系列的转换操作后，加载到数据仓库中。
   > 提取：识别数据源、数据抽取、抽取策略
   > 转换：数据清洗、标准化、集成合并、转换计算
   > 加载：设计目标数据模型、数据加载方式、数据质量验证、数据索引优化

4. 接表问题datax和sqoop差别

5. hive原理

6. 小文件产生的原因和小文件治理

7. hive优化

8. hive shuffle和spark shuffle区别

9. sql题：连续登录

